<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å¥‡è¹Ÿå¿ƒéˆï½œå…¬å‘Šå°å¹«æ‰‹</title>
  <style>
    :root{
      --bg:#f7f2e8; --card:#fff7e8; --ink:#1f2937; --muted:#6b7280;
      --line:#e7d7b8; --btn:#1f2937; --btn2:#6b7280; --ok:#0f766e; --warn:#b45309;
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", "PingFang TC", Arial, sans-serif;
    }
    body{margin:0;background:var(--bg);color:var(--ink);font-family:var(--sans);}
    .wrap{max-width:1100px;margin:0 auto;padding:18px;}
    h1{margin:6px 0 4px;font-size:24px;}
    p{margin:0;color:var(--muted);line-height:1.6}
    .grid{display:grid;grid-template-columns:1.05fr .95fr;gap:14px;margin-top:14px;}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:14px;}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    label{display:block;font-weight:800;margin:10px 0 6px;}
    input[type="text"], input[type="date"], textarea, select{
      width:100%;box-sizing:border-box;border:1px solid var(--line);border-radius:12px;
      padding:10px 12px;font-size:15px;background:#fff;
    }
    textarea{min-height:86px;resize:vertical;}
    .small{font-size:13px;color:var(--muted);margin-top:6px}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    button{
      border:0;border-radius:999px;padding:10px 14px;font-weight:900;cursor:pointer;
      background:var(--btn);color:#fff;
    }
    button.secondary{background:var(--btn2)}
    button.ghost{background:transparent;color:var(--btn);border:1px solid var(--line)}
    button.ok{background:var(--ok)}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:900;font-size:12px}
    .badge.ok{background:#d1fae5;color:#065f46}
    .badge.warn{background:#ffedd5;color:#9a3412}
    .mono{font-family:var(--mono);font-size:13px;line-height:1.5}
    pre{margin:0;white-space:pre-wrap;word-break:break-word;background:#0b1220;color:#e5e7eb;
      border-radius:14px;padding:12px;border:1px solid #111827;}
    .listCard{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:10px}
    .noticeHead{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .noticeTitle{font-weight:1000;font-size:16px}
    .pill{border:1px solid var(--line);border-radius:999px;padding:4px 10px;font-size:12px;font-weight:900;color:#7a5e2a;background:#fff}
    .meta{font-size:13px;color:var(--muted);margin-top:4px}
    .hr{height:1px;background:var(--line);margin:12px 0}
    .hint{margin-top:10px;font-size:13px;color:var(--muted)}
    .danger{color:#9a3412;font-weight:900}
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="wrap">
     <h1>å¥‡è¹Ÿå¿ƒéˆï½œå…¬å‘Šå°å¹«æ‰‹</h1>
    <p>æŠŠæƒ³åˆ†äº«çš„æ¶ˆæ¯ï¼Œæº«æŸ”å¯«ä¸‹ä¾† â†’ è‡ªå‹•æ•´ç†æˆ <span class="mono">mm-notices.json</span> â†’ ä¸€éµè¤‡è£½ â†’ ä½ å†è²¼åˆ° GitHub çš„ <span class="mono">mm-notices.json</span> è¦†è“‹å³å¯ã€‚</p>

    <div class="grid">
      <!-- Left: Form -->
      <div class="card">
        <div class="row">
          <div>
            <label>schemaVersion</label>
            <input id="schemaVersion" type="text" value="1" />
            <div class="small">ä¿æŒ 1 å³å¯ï¼ˆèˆ‡ç›®å‰å…¬å‘Šæ ¼å¼ä¸€è‡´ï¼‰ã€‚</div>
          </div>
          <div>
            <label>æŒ‰ä¸‹æ™‚è‡ªå‹•å¯«å…¥ï¼ˆå°ç£æ™‚é–“ +08:00ï¼‰ã€‚</label>
            <input id="generatedAt" type="text" placeholder="æŒ‰ã€ç”¢ç”Ÿ JSONã€æ™‚è‡ªå‹•å¡«å…¥" disabled />
            <div class="small">æ™‚å€å›ºå®š +08:00ï¼ˆå°ç£ï¼‰ã€‚</div>
          </div>
        </div>

        <div class="hr"></div>

        <label>å…¬å‘Š IDï¼ˆå”¯ä¸€è­˜åˆ¥ï¼‰</label>
        <input id="id" type="text" placeholder="ä¾‹å¦‚ï¼šboard_2026-01-24_01ï¼ˆå»ºè­°ç”¨æ—¥æœŸï¼‹æµæ°´è™Ÿï¼‰" />
        <button
          type="button"
          class="ghost"
          style="margin-top:6px"
          id="btnAutoId">
           âœ¨ è‡ªå‹•ç”¢ç”Ÿå…¬å‘Š ID
        </button>

        <div class="small">ğŸŒ¿ å°æé†’ï¼šæ¯ä¸€æ¬¡ã€Œæ–°çš„å…¬å‘Šã€éƒ½è«‹ç”¨æ–°çš„ idï¼ˆé€™æœƒè®“ç´…é»åˆ¤æ–·æ›´ç©©ï¼‰ã€‚</div>

        <label>æ¨™é¡Œ title</label>
        <input id="title" type="text" placeholder="ä¾‹å¦‚ï¼šå…¬å‘Šï½œå¥‡è¹Ÿå¿ƒéˆ APP é–‹å¼µäº†" />

        <div class="row">
          <div>
            <label>ç‰ˆæœ¬ version</label>
            <input id="version" type="text" placeholder="ä¾‹å¦‚ï¼šv1.0.0" value="v1.0.0" />
            <div class="small">å¯ä»¥å¡« App ç‰ˆæœ¬ï¼ˆè®“å¤§å®¶çŸ¥é“é€™å‰‡å…¬å‘Šå°æ‡‰å“ªå€‹ç‰ˆæœ¬ï¼‰ã€‚</div>
          </div>
          <div>
            <label>æ—¥æœŸ date</label>
            <input id="date" type="date" />
            <div class="small">å»ºè­°å¡«ã€Œå…¬å‘Šç™¼å¸ƒæ—¥ã€ï¼ˆYYYY-MM-DDï¼‰ã€‚</div>
          </div>
        </div>

        <label style="margin-top:12px;">
          <input id="pinned" type="checkbox" />
          ç½®é ‚ pinnedï¼ˆå‹¾é¸ = ç½®é ‚ï¼‰ï¼ˆæƒ³è®“å®ƒè¢«å¤§å®¶å…ˆçœ‹åˆ°å°±å‹¾é¸ï¼‰
        </label>

        <label>æ‘˜è¦ summary</label>
        <textarea id="summary" placeholder="ä¸€æ®µçŸ­æ‘˜è¦ï¼ˆå¯é¡¯ç¤ºåœ¨åˆ—è¡¨ä¸Šï¼‰"></textarea>

        <label>é‡é» bulletsï¼ˆæ¯è¡Œä¸€é»ï¼‰</label>
        <textarea id="bullets" placeholder="ä¾‹å¦‚ï¼š
          æ–°åŠŸèƒ½å·²ä¸Šç·šï¼Œæ­¡è¿æ›´æ–°é«”é©—
          æœ¬é€±è®€æ›¸æœƒï¼šé€±å…­æ™šä¸Š 8 é»
          æœ‰ä»»ä½•éœ€è¦ï¼Œä¹Ÿæ­¡è¿å›ä¾†çœ‹çœ‹"></textarea>
        <div class="small">æ¯è¡Œæœƒè‡ªå‹•è½‰æˆ bullets é™£åˆ—ã€‚</div>

        <label>è©³ç´°å…§å®¹ details</label>
        <textarea id="details" placeholder="æƒ³å¤šèªªä¸€é»ä¹Ÿå¯ä»¥æ”¾é€™è£¡ï¼ˆå±•é–‹å¾Œé¡¯ç¤ºï¼‰"></textarea>

        <div class="btns">
          <button id="btnAdd" class="ok">åŠ å…¥å…¬å‘Šåˆ°æ¸…å–®</button>
          <button id="btnReset" class="ghost" type="button">æ¸…ç©ºè¡¨å–®</button>
          <button id="btnSeed" class="secondary" type="button">ç”¨ç¯„ä¾‹å¡«å…¥</button>
        </div>

        <div class="hint">
          âœ… ä½ å¯ä»¥å…ˆåŠ å…¥å¤šå‰‡å…¬å‘Šåˆ°å³å´æ¸…å–®ï¼Œå†ä¸€æ¬¡ç”¢ç”Ÿ JSONã€‚<br/>
          <span class="danger">é‡è¦ï¼š</span>æ–°å¢å…¬å‘Šè¦è§¸ç™¼ç´…é»ï¼Œæœ€ç©©çš„æ–¹æ³•å°±æ˜¯ã€Œæ›æ–° id + æ›´æ–° dateã€ã€‚
        </div>
      </div>

      <!-- Right: Output -->
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
          <div>
            <div style="font-weight:1000;font-size:16px;">å…¬å‘Šæ¸…å–®ï¼ˆå³å°‡è¼¸å‡ºåˆ° mm-notices.jsonï¼‰</div>
            <div class="small">æ’åºå»ºè­°ï¼šç½®é ‚åœ¨å‰ï¼Œæ—¥æœŸæ–°åœ¨å‰ï¼ˆä½ å¯æ‹–æ›³æ’åºç¬¬äºŒç‰ˆå†åŠ ï¼‰ã€‚</div>
          </div>
          <div id="status" class="badge warn">å°šæœªç”¢ç”Ÿ JSON</div>
        </div>

        <div id="noticeList"></div>

        <div class="btns">
          <button id="btnGenerate" type="button">ç”¢ç”Ÿ JSON</button>
          <button id="btnCopy" class="ok" type="button" disabled>ä¸€éµè¤‡è£½ JSON</button>
          <button id="btnDownload" class="secondary" type="button" disabled>ä¸‹è¼‰ mm-notices.json</button>
          <button id="btnClearAll" class="ghost" type="button">æ¸…ç©ºæ¸…å–®</button>
        </div>

        <div class="small" style="margin-top:10px;">
          ä½¿ç”¨æ–¹å¼ï¼šæŒ‰ã€Œç”¢ç”Ÿ JSONã€â†’ã€Œä¸€éµè¤‡è£½ JSONã€â†’ åˆ° GitHub æ‰“é–‹ <span class="mono">mm-notices.json</span> â†’ å…¨é¸è²¼ä¸Šè¦†è“‹ â†’ Commitã€‚
        </div>

        <div style="margin-top:12px;">
          <label>è¼¸å‡ºçš„ JSONï¼ˆå¯ç›´æ¥è²¼åˆ° GitHubï¼‰</label>
          <pre id="jsonOut" class="mono">{}</pre>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---------- helpers ----------
  function pad2(n){ return String(n).padStart(2,"0"); }
  function toTWISO(dt){
    // produce YYYY-MM-DDTHH:mm:ss+08:00
    const y = dt.getFullYear();
    const m = pad2(dt.getMonth()+1);
    const d = pad2(dt.getDate());
    const hh = pad2(dt.getHours());
    const mm = pad2(dt.getMinutes());
    const ss = pad2(dt.getSeconds());
    return `${y}-${m}-${d}T${hh}:${mm}:${ss}+08:00`;
  }

  function safeTrim(s){ return (s ?? "").toString().trim(); }

  function linesToArray(text){
    return safeTrim(text)
      .split(/\r?\n/)
      .map(s => s.trim())
      .filter(Boolean);
  }

  function setStatus(kind, text){
    const el = document.getElementById("status");
    el.textContent = text;
    el.className = "badge " + (kind === "ok" ? "ok" : "warn");
  }

  function downloadText(filename, text){
    const blob = new Blob([text], {type:"application/json;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 500);
  }

  // ---------- state ----------
  /** @type {Array<any>} */
  let notices = [];

  // ---------- DOM ----------
  const elSchema = document.getElementById("schemaVersion");
  const elGenAt = document.getElementById("generatedAt");

  const elId = document.getElementById("id");
  const elTitle = document.getElementById("title");
  const elVersion = document.getElementById("version");
  const elDate = document.getElementById("date");
  const elPinned = document.getElementById("pinned");
  const elSummary = document.getElementById("summary");
  const elBullets = document.getElementById("bullets");
  const elDetails = document.getElementById("details");

  const elList = document.getElementById("noticeList");
  const elJson = document.getElementById("jsonOut");

  const btnAdd = document.getElementById("btnAdd");
  const btnReset = document.getElementById("btnReset");
  const btnSeed = document.getElementById("btnSeed");

  // --- è‡ªå‹•ç”¢ç”Ÿå…¬å‘Š IDï¼ˆæ—¥æœŸ + æµæ°´è™Ÿï¼‰ ---
  const btnAutoId = document.getElementById("btnAutoId");

  btnAutoId.addEventListener("click", () => {
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = pad2(now.getMonth() + 1);
    const dd = pad2(now.getDate());
    const today = `${yyyy}-${mm}-${dd}`;

  // æ‰¾å‡ºä»Šå¤©å·²å­˜åœ¨çš„æµæ°´è™Ÿ
  const todayIds = notices
    .map(n => n.id)
    .filter(id => id && id.startsWith(`board_${today}_`));

  let nextSeq = 1;
  if (todayIds.length > 0) {
    const nums = todayIds
      .map(id => Number(id.split("_").pop()))
      .filter(n => !isNaN(n));
    if (nums.length > 0) {
      nextSeq = Math.max(...nums) + 1;
    }
  }

  elId.value = `board_${today}_${pad2(nextSeq)}`;
});



  const btnGenerate = document.getElementById("btnGenerate");
  const btnCopy = document.getElementById("btnCopy");
  const btnDownload = document.getElementById("btnDownload");
  const btnClearAll = document.getElementById("btnClearAll");

  // default date = today (local)
  (function init(){
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = pad2(now.getMonth()+1);
    const dd = pad2(now.getDate());
    elDate.value = `${yyyy}-${mm}-${dd}`;
  })();

  function renderList(){
    elList.innerHTML = "";
    if (notices.length === 0){
      const empty = document.createElement("div");
      empty.className = "small";
      empty.style.marginTop = "10px";
      empty.textContent = "ï¼ˆç›®å‰æ¸…å–®æ˜¯ç©ºçš„ã€‚å…ˆç”¨å·¦å´è¡¨å–®åŠ å…¥å…¬å‘Šã€‚ï¼‰";
      elList.appendChild(empty);
      return;
    }

    notices.forEach((n, idx) => {
      const card = document.createElement("div");
      card.className = "listCard";

      const head = document.createElement("div");
      head.className = "noticeHead";

      const title = document.createElement("div");
      title.className = "noticeTitle";
      title.textContent = n.title || "(æœªå¡«æ¨™é¡Œ)";

      const right = document.createElement("div");
      right.style.display = "flex";
      right.style.gap = "8px";
      right.style.alignItems = "center";

      if (n.pinned){
        const pill = document.createElement("span");
        pill.className = "pill";
        pill.textContent = "ç½®é ‚";
        right.appendChild(pill);
      }

      const btnUp = document.createElement("button");
      btnUp.type = "button";
      btnUp.textContent = "â†‘";
      btnUp.className = "ghost";
      btnUp.style.padding = "6px 10px";
      btnUp.onclick = () => {
        if (idx === 0) return;
        const t = notices[idx-1];
        notices[idx-1] = notices[idx];
        notices[idx] = t;
        renderList();
      };

      const btnDown = document.createElement("button");
      btnDown.type = "button";
      btnDown.textContent = "â†“";
      btnDown.className = "ghost";
      btnDown.style.padding = "6px 10px";
      btnDown.onclick = () => {
        if (idx === notices.length-1) return;
        const t = notices[idx+1];
        notices[idx+1] = notices[idx];
        notices[idx] = t;
        renderList();
      };

      const btnDel = document.createElement("button");
      btnDel.type = "button";
      btnDel.textContent = "åˆªé™¤";
      btnDel.className = "secondary";
      btnDel.style.padding = "6px 10px";
      btnDel.onclick = () => {
        notices.splice(idx, 1);
        renderList();
        setStatus("warn", "å°šæœªç”¢ç”Ÿ JSON");
        btnCopy.disabled = true;
        btnDownload.disabled = true;
      };

      right.appendChild(btnUp);
      right.appendChild(btnDown);
      right.appendChild(btnDel);

      head.appendChild(title);
      head.appendChild(right);
      card.appendChild(head);

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = `id: ${n.id} ï½œ version: ${n.version || "â€”"} ï½œ date: ${n.date || "â€”"}`;
      card.appendChild(meta);

      if (n.summary){
        const s = document.createElement("div");
        s.className = "small";
        s.style.marginTop = "8px";
        s.textContent = n.summary;
        card.appendChild(s);
      }

      elList.appendChild(card);
    });
  }

  function resetForm(){
    elId.value = "";
    elTitle.value = "";
    elVersion.value = "v1.0.0";
    // date keep
    elPinned.checked = false;
    elSummary.value = "";
    elBullets.value = "";
    elDetails.value = "";
  }

  function validateNotice(n){
    if (!n.id) return "è«‹å¡« idï¼ˆå»ºè­°ç”¨æ—¥æœŸ+æµæ°´è™Ÿï¼Œä¸”æ¯å‰‡å”¯ä¸€ï¼‰";
    if (!n.title) return "è«‹å¡« title";
    if (!n.date) return "è«‹é¸ date";
    // version can be empty but recommended
    return "";
  }

  btnAdd.addEventListener("click", (e) => {
    e.preventDefault();

    const notice = {
      id: safeTrim(elId.value),
      title: safeTrim(elTitle.value),
      version: safeTrim(elVersion.value),
      date: safeTrim(elDate.value),
      pinned: !!elPinned.checked,
      summary: safeTrim(elSummary.value),
      bullets: linesToArray(elBullets.value),
      details: safeTrim(elDetails.value),
    };

    // remove empty optional fields for cleanliness
    if (!notice.version) delete notice.version;
    if (!notice.summary) delete notice.summary;
    if (!notice.details) delete notice.details;
    if (!notice.bullets || notice.bullets.length === 0) delete notice.bullets;

    const err = validateNotice(notice);
    if (err){
      alert(err);
      return;
    }

    // id uniqueness
    if (notices.some(x => x.id === notice.id)){
      alert("é€™å€‹ id å·²ç¶“å­˜åœ¨æ–¼æ¸…å–®ä¸­ï¼Œè«‹æ›ä¸€å€‹æ–°çš„ idã€‚");
      return;
    }

    notices.unshift(notice); // default: newest on top
    renderList();
    resetForm();
    setStatus("warn", "å·²æ›´æ–°æ¸…å–®ï¼Œè«‹ç”¢ç”Ÿ JSON");
    btnCopy.disabled = true;
    btnDownload.disabled = true;
  });

  btnReset.addEventListener("click", () => resetForm());

  btnSeed.addEventListener("click", () => {
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = pad2(now.getMonth()+1);
    const dd = pad2(now.getDate());
    elId.value = `board_${yyyy}-${mm}-${dd}_01`;
    elTitle.value = "å…¬å‘Šï½œç¯„ä¾‹å…¬å‘Šï¼ˆè«‹æ”¹æˆä½ çš„å…§å®¹ï¼‰";
    elVersion.value = "v1.0.0";
    elDate.value = `${yyyy}-${mm}-${dd}`;
    elPinned.checked = true;
    elSummary.value = "é€™æ˜¯ä¸€æ®µçŸ­æ‘˜è¦ï¼ˆåˆ—è¡¨æœƒçœ‹åˆ°ï¼‰";
    elBullets.value = "ç¬¬ä¸€é»é‡é»\nç¬¬äºŒé»é‡é»";
    elDetails.value = "é€™è£¡å¯ä»¥æ”¾æ¯”è¼ƒé•·çš„å…§å®¹ï¼ˆå±•é–‹å¾Œé¡¯ç¤ºï¼‰ã€‚";
  });

  btnClearAll.addEventListener("click", () => {
    if (!confirm("ç¢ºå®šè¦æ¸…ç©ºå³å´å…¬å‘Šæ¸…å–®å—ï¼Ÿ")) return;
    notices = [];
    renderList();
    elJson.textContent = "{}";
    setStatus("warn", "å°šæœªç”¢ç”Ÿ JSON");
    btnCopy.disabled = true;
    btnDownload.disabled = true;
  });

  btnGenerate.addEventListener("click", () => {
    const schemaVersion = Number(safeTrim(elSchema.value)) || 1;
    const generatedAt = toTWISO(new Date());
    elGenAt.value = generatedAt;

    const output = {
      schemaVersion,
      generatedAt,
      notices
    };

    const pretty = JSON.stringify(output, null, 2);
    elJson.textContent = pretty;

    setStatus("ok", "JSON å·²ç”¢ç”Ÿ");
    btnCopy.disabled = false;
    btnDownload.disabled = false;
  });

  btnCopy.addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText(elJson.textContent);
      setStatus("ok", "å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ…");
      setTimeout(() => setStatus("ok","JSON å·²ç”¢ç”Ÿ"), 1200);
    }catch{
      alert("è¤‡è£½å¤±æ•—ï¼šç€è¦½å™¨å¯èƒ½é˜»æ“‹ clipboardã€‚ä½ å¯ä»¥æ‰‹å‹•å…¨é¸å³å´ JSON å†è¤‡è£½ã€‚");
    }
  });

  btnDownload.addEventListener("click", () => {
    downloadText("mm-notices.json", elJson.textContent);
  });

  // init
  renderList();
</script>
</body>
</html>
